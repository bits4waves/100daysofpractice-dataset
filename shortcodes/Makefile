ifndef IG_USER
$(error IG_USER is not set)
endif

PYTHON=python
SRC=../src
GET_SHORTCODES_PY=$(SRC)/get-shortcodes.py
SHORTCODES_ORIG=shortcodes-orig.txt
SHORTCODES_TEST=shortcodes-test.txt
SHORTCODES_SORT=shortcodes-sort.txt
SHORTCODES_UNIQ=shortcodes-uniq.txt
SHORTCODES_LINK=shortcodes.txt
INTERMEDIATES=$(SHORTCODES_ORIG) $(SHORTCODES_TEST) $(SHORTCODES_SORT)
OBJECTS = $(INTERMEDIATES) $(SHORTCODES_UNIQ)

all: $(OBJECTS)

$(SHORTCODES_ORIG): $(GET_SHORTCODES_PY)
	$(PYTHON) $(GET_SHORTCODES_PY)

$(SHORTCODES_TEST): $(SHORTCODES_ORIG)
	head --lines=10 $(SHORTCODES_ORIG) > $(SHORTCODES_TEST)

$(SHORTCODES_SORT): $(SHORTCODES_ORIG)
	sort $(SHORTCODES_ORIG) > $(SHORTCODES_SORT)

$(SHORTCODES_UNIQ): $(SHORTCODES_SORT)
	uniq $(SHORTCODES_SORT) > $(SHORTCODES_UNIQ)
	ln --symbolic $(SHORTCODES_UNIQ) $(SHORTCODES_LINK)

clean-intermediates:
	rm -rf $(INTERMEDIATES)

clean:
	rm -rf $(OBJECTS) $(SHORTCODES_LINK)
